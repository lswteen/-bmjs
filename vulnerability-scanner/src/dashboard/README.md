# Dashboard Refactoring

## 개요
TDD, BDD, OOP 개념을 적용하여 dashboard를 기능 단위로 구조화한 리팩토링 프로젝트입니다.

## 새로운 구조

```
dashboard/
├── features/                    # 기능별 모듈화
│   ├── cve/                    # CVE 관련 기능
│   │   ├── controllers/        # HTTP 요청 처리
│   │   ├── services/           # 비즈니스 로직
│   │   ├── repositories/       # 데이터 접근 계층
│   │   ├── tests/              # 단위 테스트
│   │   └── routes.js           # 라우트 정의
│   ├── git/                    # Git 프로젝트 관련 기능
│   │   ├── controllers/
│   │   ├── services/
│   │   ├── repositories/
│   │   └── routes.js
│   ├── scan/                   # 취약점 스캔 기능
│   │   ├── controllers/
│   │   ├── services/
│   │   ├── tests/
│   │   └── routes.js
│   └── chatbot/                # AI 챗봇 기능
│       ├── controllers/
│       ├── services/
│       └── routes.js
├── shared/                     # 공유 모듈
│   ├── middleware/             # 공통 미들웨어
│   └── container.js            # DI 컨테이너
├── public/                     # 정적 파일
└── server-refactored.js        # 새로운 서버 엔트리포인트
```

## 적용된 개념

### 1. OOP (객체지향 프로그래밍)
- **클래스 기반 설계**: 모든 컴포넌트를 클래스로 구현
- **캡슐화**: 각 계층의 책임을 명확히 분리
- **단일 책임 원칙**: 각 클래스는 하나의 책임만 가짐

### 2. 계층 구조 (Layered Architecture)
- **Controller**: HTTP 요청/응답 처리
- **Service**: 비즈니스 로직 구현
- **Repository**: 데이터 접근 추상화

### 3. 의존성 주입 (Dependency Injection)
- `Container` 클래스를 통한 중앙집중식 의존성 관리
- 느슨한 결합으로 테스트 용이성 향상
- Singleton 패턴으로 인스턴스 관리

### 4. TDD/BDD
- 각 Service에 대한 단위 테스트 작성
- Given-When-Then 패턴 사용
- Mock 객체를 활용한 격리된 테스트

## 주요 기능별 구조

### CVE 기능
- **CveController**: CVE 조회, 필터링, 엑셀 내보내기 요청 처리
- **CveService**: CVE 검색, 필터 옵션, 시각화 데이터 제공
- **CveRepository**: CVE 데이터베이스 접근

### Git 기능
- **GitController**: Git 프로젝트 동기화, 조회, 엑셀 내보내기
- **GitService**: Git 프로젝트 관리 비즈니스 로직
- **GitRepository**: Git 데이터베이스 접근

### Scan 기능
- **ScanController**: 스캔 실행, 결과 조회, 상태 확인
- **ScanService**: 스캔 실행 및 결과 관리
- 동시 스캔 방지 로직 포함

### Chatbot 기능
- **ChatbotController**: 챗봇 메시지 처리
- **ChatbotService**: RAG 기반 CVE 컨텍스트 추출 및 응답 생성
- vLLM 서비스와 통합

## 테스트 실행

```bash
# CVE Service 테스트
node src/dashboard/features/cve/tests/CveService.test.js

# Scan Service 테스트
node src/dashboard/features/scan/tests/ScanService.test.js
```

## 마이그레이션 가이드

### 기존 server.js에서 새 구조로 전환

1. **서버 실행 파일 변경**
   ```bash
   # 기존
   node src/dashboard/server.js
   
   # 새로운 구조
   node src/dashboard/server-refactored.js
   ```

2. **API 엔드포인트 변경 없음**
   - 모든 기존 API 엔드포인트는 동일하게 유지
   - 하위 호환성 보장

3. **점진적 마이그레이션**
   - 새로운 기능은 features/ 구조로 개발
   - 기존 코드는 필요시 점진적으로 마이그레이션

## 장점

1. **유지보수성**: 기능별로 명확히 분리되어 코드 찾기 쉬움
2. **테스트 용이성**: 각 계층을 독립적으로 테스트 가능
3. **확장성**: 새로운 기능 추가 시 일관된 구조 적용
4. **재사용성**: Service와 Repository는 다른 컨텍스트에서 재사용 가능
5. **협업**: 기능별로 작업 분리 가능

## 다음 단계

1. **통합 테스트 추가**: E2E 테스트 작성
2. **기존 server.js 마이그레이션**: 완전히 새 구조로 전환
3. **API 문서화**: Swagger/OpenAPI 스펙 추가
4. **에러 처리 강화**: 커스텀 에러 클래스 추가
5. **로깅 개선**: 구조화된 로깅 시스템 도입
