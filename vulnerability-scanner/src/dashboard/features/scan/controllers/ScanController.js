/**
 * Scan Controller
 * Handles HTTP requests for vulnerability scanning operations
 */
export class ScanController {
    constructor(scanService) {
        this.scanService = scanService;
    }

    /**
     * Get latest scan results
     * @param {Object} req - Express request
     * @param {Object} res - Express response
     */
    async getResults(req, res) {
        try {
            const results = await this.scanService.getLatestResults();
            res.json({ success: true, data: results });
        } catch (error) {
            res.status(500).json({ success: false, error: error.message });
        }
    }

    /**
     * Trigger new scan
     * @param {Object} req - Express request
     * @param {Object} res - Express response
     */
    async triggerScan(req, res) {
        try {
            const result = await this.scanService.performScan();
            res.json({ success: true, ...result });
        } catch (error) {
            res.status(500).json({ success: false, error: error.message });
        }
    }

    /**
     * Get scan status
     * @param {Object} req - Express request
     * @param {Object} res - Express response
     */
    getStatus(req, res) {
        const status = this.scanService.getStatus();
        res.json(status);
    }

    /**
     * Get list of projects
     * @param {Object} req - Express request
     * @param {Object} res - Express response
     */
    async getProjects(req, res) {
        try {
            const projects = await this.scanService.getProjects();
            res.json({ success: true, data: projects });
        } catch (error) {
            res.status(500).json({ success: false, error: error.message });
        }
    }

    /**
     * Get vulnerabilities for a specific project
     * @param {Object} req - Express request
     * @param {Object} res - Express response
     */
    async getProjectVulnerabilities(req, res) {
        try {
            const projectKey = req.params.projectKey;
            const vulnerabilities = await this.scanService.getProjectVulnerabilities(projectKey);

            if (!vulnerabilities) {
                return res.status(404).json({
                    success: false,
                    message: 'Project not found'
                });
            }

            res.json({ success: true, data: vulnerabilities });
        } catch (error) {
            res.status(500).json({ success: false, error: error.message });
        }
    }
}
