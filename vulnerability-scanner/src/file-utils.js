import fs from 'fs/promises';
import path from 'path';

/**
 * Recursively find files with specific extensions
 * Replaces 'glob' library functionality using native Node.js fs
 */
export async function findFiles(dir, pattern) {
    const results = [];

    try {
        // Check if dir exists
        try {
            await fs.access(dir);
        } catch {
            return [];
        }

        // Use recursive readdir (available in Node 20+)
        const entries = await fs.readdir(dir, { recursive: true, withFileTypes: true });

        for (const entry of entries) {
            if (!entry.isFile()) continue;

            const fullPath = path.join(entry.parentPath || entry.path, entry.name);

            // Simple pattern matching
            if (pattern.endsWith('*.json') && entry.name.endsWith('.json')) {
                results.push(fullPath);
            } else if (pattern.endsWith('pom.xml') && entry.name === 'pom.xml') {
                results.push(fullPath);
            } else if (pattern.includes('build.gradle') && entry.name.startsWith('build.gradle')) {
                results.push(fullPath);
            }
        }
    } catch (error) {
        console.warn(`Warning: Error scanning directory ${dir}: ${error.message}`);
    }

    return results;
}
