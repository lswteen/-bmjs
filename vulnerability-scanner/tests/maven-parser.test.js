import { MavenParser } from '../src/parsers/maven-parser.js';

describe('MavenParser', () => {
    let parser;

    beforeEach(() => {
        parser = new MavenParser();
    });

    it('should parse simple properties', () => {
        const pomContent = `
            <project>
                <properties>
                    <spring.version>3.2.1</spring.version>
                </properties>
            </project>
        `;
        // We need to mock XML parsing or just test the public method resolveProperties if exposed, 
        // but extractProperties is used internally. 
        // Let's test full parse which is more integration-like but good.

        // Since parse is async properly
    });

    it('should resolve property placeholders in dependencies', async () => {
        const pomContent = `
            <project>
                <modelVersion>4.0.0</modelVersion>
                <groupId>com.example</groupId>
                <artifactId>test-app</artifactId>
                <version>1.0.0</version>
                <properties>
                    <tika.version>1.7</tika.version>
                </properties>
                <dependencies>
                    <dependency>
                        <groupId>org.apache.tika</groupId>
                        <artifactId>tika-core</artifactId>
                        <version>\${tika.version}</version>
                    </dependency>
                </dependencies>
            </project>
        `;

        const result = await parser.parse(pomContent);
        expect(result.dependencies).toHaveLength(1);
        expect(result.dependencies[0].version).toBe('1.7');
    });

    it('should extract java version from maven-compiler-plugin', async () => {
        const pomContent = `
            <project>
                <build>
                    <plugins>
                        <plugin>
                            <artifactId>maven-compiler-plugin</artifactId>
                            <configuration>
                                <release>17</release>
                            </configuration>
                        </plugin>
                    </plugins>
                </build>
            </project>
        `;

        const result = await parser.parse(pomContent);
        expect(result.javaVersion).toBe('17');
    });
});
